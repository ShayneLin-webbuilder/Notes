<!DOCTYPE html><html><head>
      <title>NodeJS</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:////Users/shayne_lin/.vscode/extensions/shd101wyy.markdown-preview-enhanced-0.6.2/node_modules/@shd101wyy/mume/dependencies/katex/katex.min.css">
      
      
      
      
      
      
      
      
      
      <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      <h2 class="mume-header" id="node-js">Node JS</h2>

<h3 class="mume-header" id="1-basic-information-about-node">1. Basic Information about Node</h3>

<hr>
<ul>
<li>Node is a runtime environment for executing JS code and it allows javascript to run on the server side</li>
<li>Essentially, Node is a C++ program that embeds Chrome&#x2019;s v8 engine, the fastest JS engine in the world.</li>
<li>We use Node to build fast and scalable networking applications. It&#x2019;s a perfect choice for <code>building RESTful services</code>.</li>
<li>Node applications are <code>single-threaded</code>. That means a single thread is used to serve all clients.</li>
<li>Node applications are <code>asynchronous</code> or non-blocking by default. That means when the application involves I/O operations (eg accessing the file system or the network), the thread doesn&#x2019;t wait (or block) for the result of the operation. It is released to serve other clients.</li>
<li>This architecture makes Node ideal for building I/O-intensive applications.</li>
<li>You should avoid using Node for CPU-intensive applications, such as a video encoding service. Because while executing these operations, other clients have to wait for the single thread to finish its job and be ready to serve them.</li>
<li>In Node, we <code>don&#x2019;t have browser environment objects</code> such as window or the document object. Instead, we have other objects that are not available in browsers, such as objects for working with the file system, network, operating system, etc.<br>
<br><br>
<br></li>
</ul>
<h3 class="mume-header" id="2-node-console">2. Node Console</h3>

<hr>
<p>run <code>node</code> in terminal</p>
<h3 class="mume-header" id="3-api-data-format">3. API Data Format</h3>

<hr>
<blockquote>
<p>XML</p>
</blockquote>
<ul>
<li>Extended Markup Language</li>
<li>XML is syntacticly similar to HTML, but it does not describe presentation like HTML does</li>
</ul>
<pre data-role="codeBlock" data-info="XML" class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>person</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>age</span><span class="token punctuation">&gt;</span></span>21<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>age</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>Dylan<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>city</span><span class="token punctuation">&gt;</span></span>Guangzhou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>city</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>person</span><span class="token punctuation">&gt;</span></span>
</pre><blockquote>
<p>JSON</p>
</blockquote>
<ul>
<li>Javascript Object Notation</li>
<li>looks exactly like Javascript objects, but everything is a string</li>
</ul>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// the same example as XML above</span>
<span class="token punctuation">{</span>
	<span class="token string">&quot;person&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token string">&quot;age&quot;</span><span class="token operator">:</span> <span class="token string">&quot;21&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Travis&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;city&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Guangzhou&quot;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><h3 class="mume-header" id="2-node-module-system">2. Node Module System</h3>

<hr>
<ul>
<li>Global objects (<b><code>global</code></b>):<br>
<br><br>
Example: <code>console.log()</code>, <code>setTimeout()</code>, <code>setInterval()</code> ...<br>
<br><br>
These are the shorten version of <code>global.console.log()</code>, <code>global.setTimeout()</code>,...</li>
</ul>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token keyword keyword-var">var</span> message <span class="token operator">=</span> <span class="token string">&apos;new message&apos;</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>global<span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation">)</span> <span class="token comment">// undefined because message is only available at the current file</span>
</pre><br>
<ul>
<li>Module(<b><code>module</code></b>):<br>
<br><br>
<code>console.log(module);</code><br>
<br><br>
In Node, every file is a module. Functions and variables are defined in the scope of the module.</li>
</ul>
<br>
<ul>
<li>Export Module functions/variables(<code>module.exports</code>)</li>
</ul>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// Example 1 (export several things)</span>
<span class="token keyword keyword-var">var</span> url <span class="token operator">=</span> <span class="token string">&apos;http://www.google.com&apos;</span><span class="token punctuation">;</span>
<span class="token keyword keyword-function">function</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// add the display function to the exports class with the name `displayFunction`</span>
module<span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token punctuation">.</span><span class="token property-access">displayFunction</span> <span class="token operator">=</span> display<span class="token punctuation">;</span>
<span class="token comment">// add the url to the exports class with the name `url`</span>
module<span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token punctuation">.</span><span class="token property-access">url</span> <span class="token operator">=</span> url<span class="token punctuation">;</span>
</pre><pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// when console.log(module) with the file above, we can get the `exports` element of module contains:</span>
exports<span class="token operator">:</span> <span class="token punctuation">{</span> displayFunction<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token known-class-name class-name">Function</span><span class="token operator">:</span> display<span class="token punctuation">]</span><span class="token punctuation">,</span> url<span class="token operator">:</span> <span class="token string">&apos;http://www.google.com&apos;</span> <span class="token punctuation">}</span>
</pre><pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// Example 2 (alternative way of exporting a single thing)</span>
<span class="token keyword keyword-function">function</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// we don&apos;t have to specify the name of the elements inside the exports object if we export in this way</span>
module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> display<span class="token punctuation">;</span>
</pre><br>
<ul>
<li>load module(<code>requrie</code>):<br>
<br><br>
<code>require(&apos;relative-path-to-desired-module&apos;);</code><br>
<br></li>
</ul>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// Using the two exports examples above</span>

<span class="token comment">// Example 1</span>
<span class="token keyword keyword-const">const</span> utility <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;relative-path&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>utility<span class="token punctuation">.</span><span class="token property-access">url</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// http://www.google.com</span>
utility<span class="token punctuation">.</span><span class="token method function property-access">displayFunction</span><span class="token punctuation">(</span><span class="token string">&apos;message&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// message</span>

<span class="token comment">// Example 2</span>
<span class="token keyword keyword-const">const</span> utility <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;relative-path&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">utility</span><span class="token punctuation">(</span><span class="token string">&apos;message&apos;</span><span class="token punctuation">)</span> <span class="token comment">// message</span>
</pre><br>
<ul>
<li>Module Wrapper Function: in each module, there is a function that wraps everything (created by Node)</li>
</ul>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// The wrapper function is something like below:</span>
<span class="token punctuation">(</span><span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> require<span class="token punctuation">,</span> module<span class="token punctuation">,</span> __filename<span class="token punctuation">,</span> __dirname</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token spread operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// This means inside each module, `exports`, `require`, ... are local to that module</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span> <span class="token comment">// absolute path to this file</span>
</pre><br>
<ul>
<li><a href="https://nodejs.org/api/modules.html">Built-in module: </a></li>
</ul>
<blockquote>
<p><code>path</code> module</p>
</blockquote>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// built in `path` module</span>
<span class="token keyword keyword-const">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;path&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-var">var</span> pathObj <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// built in `os` module</span>
<span class="token comment">// Without Node, javascript is only working on the browser (dealing with `window` or `document`)</span>
<span class="token comment">// Node allows javascript to be exercised outside the browser and have access to the operating system</span>
<span class="token keyword keyword-const">const</span> os <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">os</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-var">var</span> totalMemory <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token method function property-access">totalmem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-var">var</span> freeMemory <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token method function property-access">freemem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><blockquote>
<p>File system (<code>fs</code>) module</p>
</blockquote>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// built in `fs` module (file system)</span>
<span class="token keyword keyword-const">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;fs&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// for each function of `fs`, it has both synchronous and asynchronous versions</span>
<span class="token comment">// always prefer to use asynchronous version which is more efficient and Node has only a single thread</span>

<span class="token comment">// synchronous version:</span>
<span class="token comment">// get all the names of the files of a specific path</span>
<span class="token keyword keyword-const">const</span> files <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token method function property-access">readdirSync</span><span class="token punctuation">(</span><span class="token string">&apos;./&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// asynchronous version:</span>
fs<span class="token punctuation">.</span><span class="token method function property-access">readdir</span><span class="token punctuation">(</span><span class="token string">&apos;./&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> files</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Error&apos;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-else">else</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Result&apos;</span><span class="token punctuation">,</span> files<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><blockquote>
<p><code>events</code> module</p>
</blockquote>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// built in `events` module</span>
<span class="token comment">// Order of the code matters (setup a listener first before raise an event)</span>

<span class="token comment">// EventEmitter is a class</span>
<span class="token keyword keyword-const">const</span> <span class="token maybe-class-name">EventEmitter</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;events&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// emitter is an instance of the class EventEmitter</span>
<span class="token keyword keyword-const">const</span> emitter <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Register a listener</span>
<span class="token comment">// &apos;messageLogged&apos; is the name of the event</span>
<span class="token comment">// the function will be called once the listener is called</span>
emitter<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">&apos;messageLogged&apos;</span><span class="token punctuation">,</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Listener called&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Raise an event</span>
emitter<span class="token punctuation">.</span><span class="token method function property-access">emit</span><span class="token punctuation">(</span><span class="token string">&apos;messageLogged&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// built in `events` module with arguments</span>
<span class="token keyword keyword-const">const</span> <span class="token maybe-class-name">EventEmitter</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;events&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> emitter <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// the name of the arguments is arg (can be any)</span>
emitter<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">&apos;Login&apos;</span><span class="token punctuation">,</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Listener called&apos;</span><span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Raise an event with arguments</span>
emitter<span class="token punctuation">.</span><span class="token method function property-access">emit</span><span class="token punctuation">(</span><span class="token string">&apos;Login&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>userName<span class="token operator">:</span> <span class="token string">&apos;lin&apos;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">21</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// use the event raiser from other file</span>
<span class="token comment">// App.js</span>
<span class="token keyword keyword-const">const</span> <span class="token maybe-class-name">Logger</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./Logger&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> logger <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

logger<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">&apos;messageLogged&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Listener called&apos;</span><span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

logger<span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;message&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//Logger.js</span>
<span class="token keyword keyword-const">const</span> <span class="token maybe-class-name">EventEmitter</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;events&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-class">class</span> <span class="token class-name">Logger</span> <span class="token keyword keyword-extends">extends</span> <span class="token class-name">EventEmitter</span> <span class="token punctuation">{</span>
    <span class="token comment">// the function of a class does not requrie `function` in the front</span>
    <span class="token comment">// because it&apos;s a method</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// `this` indicates the `Logger` class</span>
        <span class="token comment">// since the `Logger` class extends EventEmitter,</span>
        <span class="token comment">// it has all the capabilities as the `EventEmitter` class</span>
        <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token method function property-access">emit</span><span class="token punctuation">(</span><span class="token string">&apos;messageLogged&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> url<span class="token operator">:</span> <span class="token string">&apos;http://&apos;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token maybe-class-name">Logger</span><span class="token punctuation">;</span>
</pre><blockquote>
<p><code>http</code> module</p>
</blockquote>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token keyword keyword-const">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;http&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token method function property-access">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// create the rounte &apos;/&apos; with response &apos;Hello World&apos;</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">url</span> <span class="token operator">===</span> <span class="token string">&apos;/&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span><span class="token string">&apos;Hello World&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token method function property-access">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// create another route &apos;/api/courses/&apos; with response JSON format</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">url</span> <span class="token operator">===</span> <span class="token string">&apos;/api/courses&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token method function property-access">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// The server listens to the port number 3000</span>
server<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Listen on port 3000...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><blockquote>
<p><code>devDependencies</code></p>
</blockquote>
<ul>
<li>devDependencies will not be uploaded to the production version</li>
<li>When we install the deveDependencies, <code>npm install dev_dependency_name --save-dev</code> to tell the node that it&apos;s a devDependency</li>
</ul>
<blockquote>
<p>Remove a dependency</p>
</blockquote>
<ul>
<li><code>npm un package_name</code></li>
</ul>
<br>
<h3 class="mume-header" id="3-node-package-manager">3. Node Package Manager</h3>

<hr>
<ul>
<li>For the front end, we can just include the script tag to include libraries (eg. bootstrap), but there is no script tag for the node, so we can use npm to download the packages</li>
</ul>
<blockquote>
<p><code>package.json</code></p>
</blockquote>
<ul>
<li>run <code>npm init</code> or <code>npm init --yes</code>(for shortcut)</li>
<li>create <code>package.json</code> before adding any npm packages</li>
</ul>
<blockquote>
<p>Install npm packages</p>
</blockquote>
<ul>
<li><code>npm install package_name</code></li>
<li>installed packages will be stored in node_modules</li>
<li>don&apos;t have to use <code>npm install package_name --save</code> anymore</li>
<li>install a specific version of a package: <code>npm install package_name@version_number</code></li>
</ul>
<blockquote>
<p>Use npm packages</p>
</blockquote>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// terminal:</span>
npm install underscore


<span class="token comment">// app.js:</span>
<span class="token comment">// Node will check first if &apos;underscore&apos; is a core module</span>
<span class="token comment">// then check if &apos;underscore&apos; is a file or folder</span>
<span class="token comment">// then check if &apos;underscore&apos; is in the node_modules</span>
<span class="token keyword keyword-var">var</span> _ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;underscore&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><blockquote>
<p>npm packages source control</p>
</blockquote>
<ul>
<li>Don&apos;t include node_modules in source control (eg. github) because we can get the dependencies by using <code>package.json</code></li>
</ul>
<blockquote>
<p>Semantic versioning in <code>package.json</code></p>
</blockquote>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// the version of `mongoose` in the package.json as below</span>
<span class="token punctuation">{</span>
    <span class="token spread operator">...</span>
    <span class="token string">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;mongoose&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^5.9.22&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><ul>
<li>
<p>According to the semantic versioning, <code>5.9.22</code> version means <code>major.minor.patch</code> version.</p>
<ul>
<li>patch version increases: bugs fixed to be more stable</li>
<li>minor version increases: add new features without breaking the api</li>
<li>major version increases: potentially break the api depends on the current version</li>
</ul>
</li>
<li>
<p><code>^</code> in &quot;mongoose&quot; : &quot;^5.9.22&quot; means depends on any versions of <code>mongoose</code> with major version <code>5</code> (<code>5.x</code> version)</p>
</li>
<li>
<p><code>~</code> in &quot;~5.9.22&quot; means depends on versions <code>5.9.x</code> (major and minor versions should be the same)</p>
</li>
<li>
<p>&quot;5.9.22&quot; means the dependency has to be exact version <code>5.9.22</code></p>
</li>
</ul>
<blockquote>
<p>Listing the installed packages</p>
</blockquote>
<ul>
<li><code>npm list</code> show every dependency and its dependency</li>
<li><code>npm list --depth=0</code> show only the dependency in the <code>package.json</code></li>
</ul>
<blockquote>
<p>View the npm packages</p>
</blockquote>
<ul>
<li><code>npm view package_name</code> display all the info of the package</li>
<li><code>npm view package_name dependencies</code> display only the area (dependencies in this case) of the package</li>
</ul>
<br>
<h3 class="mume-header" id="3-restful-apis-using-express">3. Restful APIs Using Express</h3>

<hr>
<blockquote>
<p>RESTful services</p>
</blockquote>
<ul>
<li>REST defines a set of conventions for creating HTTP services:
<ul>
<li>POST: to create a resource</li>
<li>PUT: to update it</li>
<li>GET: to read it</li>
<li>DELETE: to delete</li>
</ul>
</li>
<li>HTTP protocol connects between <code>client</code> and <code>server</code></li>
</ul>
<blockquote>
<p>Express</p>
</blockquote>
<ul>
<li><code>npm install express</code></li>
<li>Express http <code>get</code> method</li>
</ul>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// express http `get` method</span>
<span class="token keyword keyword-const">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// `/` is the end point for this case</span>
app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">&apos;Hello World&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// `/api/courses` is the end point</span>
app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&apos;/api/courses&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Listening on port 3000...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><blockquote>
<p><code>nodemon</code></p>
</blockquote>
<ul>
<li><code>npm install i -g nodemon</code></li>
<li>any updates on code can be restarted automatically without manually close the terminal and restart</li>
<li>instead of using <code>node file_name.js</code>, use <code>nodemon file_name.js</code> to run the file</li>
</ul>
<blockquote>
<p><code>Environment Variables</code></p>
</blockquote>
<ul>
<li>
<p>In order to make the <code>get</code> example more appropriate in both dev and prod versions, we need to use the environmental variables to provide a proper port for both cases</p>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token keyword keyword-const">const</span> port <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">3000</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></li>
<li>
<p>Set environment variable:</p>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// terminal: </span>
<span class="token comment">// set the environmental variable `PORT` to be 5000</span>
<span class="token keyword module keyword-export">export</span> <span class="token constant">PORT</span><span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">;</span>
</pre></li>
</ul>
<blockquote>
<p>Route Parameters</p>
</blockquote>
<ul>
<li>
<p>original <code>get</code> method</p>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// return all the courses from the database</span>
app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&apos;/api/courses&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token spread operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></li>
<li>
<p>to get a specific course, include the id in the route</p>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// /:id is a parameter of the route</span>
<span class="token comment">// id can also be replaced by courseID or something else</span>
app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&apos;/api/courses/:id&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// we can access the id from the route</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// several params in route</span>
app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&apos;/api/posts/:year/:month&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// params objects</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// query object: </span>
<span class="token comment">// start with `?` and use `&amp;` to connect different query parameters</span>
<span class="token comment">// http://localhost:3000/api/posts?name=dylan&amp;age=21</span>
app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&apos;/api/posts&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {&quot;name&quot;: &quot;dylan&quot;, &quot;age&quot;: 21}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></li>
</ul>
<blockquote>
<p>Handling HTTP <code>GET</code> Requests</p>
</blockquote>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token keyword keyword-const">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> courses <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">&apos;course1&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">&apos;course2&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">&apos;course3&apos;</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token comment">// get all the courses</span>
app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&apos;/api/courses&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>courses<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// find the course with a given id</span>
app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&apos;/api/courses/:id&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> course <span class="token operator">=</span> courses<span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token parameter">course</span> <span class="token arrow operator">=&gt;</span> course<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// when the course is not found</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>course<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow keyword-return">return</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">&apos;The course with the given id is not found&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>course<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><blockquote>
<p>Handling HTTP <code>POST</code> request</p>
</blockquote>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token keyword keyword-const">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// express.json() returns a middleware</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// enable express parsing json </span>

<span class="token keyword keyword-const">const</span> courses <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">&apos;course1&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">&apos;course2&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">&apos;course3&apos;</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token comment">// get all the courses</span>
app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&apos;/api/courses&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>courses<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">&apos;/api/courses&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> course <span class="token operator">=</span> <span class="token punctuation">{</span>
        id<span class="token operator">:</span> courses<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
        name<span class="token operator">:</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token comment">// assume req.body is an object with name as the property</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    courses<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>course<span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>course<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// and we can display the pushed course on the page</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Listening on port 3000...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</pre><blockquote>
<p>Postman</p>
</blockquote>
<ul>
<li>We can use the chrome postman extention</li>
<li>Use the same example as above. Enter the objects in the <code>body</code> section as below and click send</li>
<li><img src="https://github.com/DylanLin29/Notes/blob/master/Web%20Development/Images/Postman%20example.png" alt="alt text"></li>
<li>When send a post request, we can add the data inside <code>body</code> of Postman</li>
</ul>
<blockquote>
<p>Validation of the requests</p>
</blockquote>
<ul>
<li>Simple validation of the requests<pre data-role="codeBlock" data-info="Javascript" class="language-javascript">app<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">&apos;/api/courses&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// simple validation</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">||</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// status code 400 means bad request</span>
        res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">&apos;Name is required and should be minimum 3 characters&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// return so that the remaining code will not be executed</span>
        <span class="token keyword control-flow keyword-return">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-const">const</span> course <span class="token operator">=</span> <span class="token punctuation">{</span>
        id<span class="token operator">:</span> courses<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
        name<span class="token operator">:</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token comment">// assume req.body is an object with name as the property</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    courses<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>course<span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>course<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// and we can display the pushed course on the page</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></li>
<li>Validation using an npm package <code>joi</code>
<ul>
<li><code>npm install joi</code></li>
</ul>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// validation using `joi` example</span>
<span class="token keyword keyword-const">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> <span class="token maybe-class-name">Joi</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;joi&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// enable express parsing json </span>

<span class="token keyword keyword-const">const</span> courses <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">&apos;course1&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">&apos;course2&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">&apos;course3&apos;</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

app<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">&apos;/api/courses&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> schema <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token comment">// indicate that the name is string type</span>
        <span class="token comment">// at least 3 characters</span>
        <span class="token comment">// required: users have to input the name</span>
        name<span class="token operator">:</span> <span class="token maybe-class-name">Joi</span><span class="token punctuation">.</span><span class="token method function property-access">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">min</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">required</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// validate the body with the schema</span>
    <span class="token comment">// return a promise</span>
    <span class="token keyword keyword-const">const</span> result <span class="token operator">=</span> <span class="token maybe-class-name">Joi</span><span class="token punctuation">.</span><span class="token method function property-access">validate</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// if there is no error, result.error is null</span>
    <span class="token keyword control-flow keyword-if">if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token property-access">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token property-access">error</span><span class="token punctuation">.</span><span class="token property-access">details</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// or send the original error: `result.error` (more complicated)</span>
        <span class="token keyword control-flow keyword-return">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-const">const</span> course <span class="token operator">=</span> <span class="token punctuation">{</span>
        id<span class="token operator">:</span> courses<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
        name<span class="token operator">:</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token property-access">name</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    courses<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>course<span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>course<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></li>
</ul>
<blockquote>
<p>Handling <code>PUT</code> Requests (update)</p>
</blockquote>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// Update document example</span>
<span class="token keyword keyword-const">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> <span class="token maybe-class-name">Joi</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;joi&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// enable express parsing json </span>

<span class="token keyword keyword-const">const</span> courses <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">&apos;course1&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">&apos;course2&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">&apos;course3&apos;</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token comment">// since we are updating a specific document</span>
<span class="token comment">// we need to get its id</span>
app<span class="token punctuation">.</span><span class="token method function property-access">put</span><span class="token punctuation">(</span><span class="token string">&apos;/api/courses/:id&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Steps: </span>
    <span class="token comment">// 1. Look up the course. If not exists, return 404</span>
    <span class="token comment">// 2. Validate the request. If invalid, return 400 - Bad request</span>
    <span class="token comment">// 3. Update the course. Return the updated course</span>

    <span class="token comment">// Step 1: Look up</span>
    <span class="token keyword keyword-const">const</span> course <span class="token operator">=</span> courses<span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token parameter">course</span> <span class="token arrow operator">=&gt;</span> course<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// when the course is not found</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>course<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow keyword-return">return</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">&apos;The course with the given id is not found&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Step 2: Validate</span>
    <span class="token keyword keyword-const">const</span> schema <span class="token operator">=</span> <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token maybe-class-name">Joi</span><span class="token punctuation">.</span><span class="token method function property-access">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">min</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">required</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-const">const</span> result <span class="token operator">=</span> <span class="token maybe-class-name">Joi</span><span class="token punctuation">.</span><span class="token method function property-access">validate</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword control-flow keyword-if">if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token property-access">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token property-access">error</span><span class="token punctuation">.</span><span class="token property-access">details</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// or send the original error: `result.error` (more complicated)</span>
        <span class="token keyword control-flow keyword-return">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Step 3: Update</span>
    course<span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>course<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Listening on port 3000...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><blockquote>
<p>Handling HTTP <code>Delete</code> Requests</p>
</blockquote>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token keyword keyword-const">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> <span class="token maybe-class-name">Joi</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;joi&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// enable express parsing json </span>

<span class="token keyword keyword-const">const</span> courses <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">&apos;course1&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">&apos;course2&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">&apos;course3&apos;</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

app<span class="token punctuation">.</span><span class="token method function property-access">delete</span><span class="token punctuation">(</span><span class="token string">&apos;/api/courses/:id&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Steps: </span>

    <span class="token comment">// 1. Look up the course. If not exists, return 404</span>
    <span class="token keyword keyword-const">const</span> course <span class="token operator">=</span> courses<span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token parameter">course</span> <span class="token arrow operator">=&gt;</span> course<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// when the course is not found</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>course<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">&apos;The course with the given id is not found&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow keyword-return">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 2. Delete and return the removed course</span>
    <span class="token keyword keyword-const">const</span> index <span class="token operator">=</span> courses<span class="token punctuation">.</span><span class="token method function property-access">indexOf</span><span class="token punctuation">(</span>course<span class="token punctuation">)</span><span class="token punctuation">;</span>
    courses<span class="token punctuation">.</span><span class="token method function property-access">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>course<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Listening on port 3000...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><blockquote>
<p>Middleware</p>
</blockquote>
<ul>
<li>Middleware gives you access to <code>req</code> and <code>res</code> in the apps request -&gt; response cycle</li>
<li>Middleware usually are called between processing the request and sending the response in the application.</li>
<li>Middleware functions are called in sequence. There is usually a chain of functions that are called one after the other</li>
<li>must call <code>next()</code> (unless it&apos;s the last function in the chain). Otherwise, the request will just hang and eventually timeout.</li>
<li>Examples of middleware functions:<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// Example 1</span>
<span class="token keyword keyword-const">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token string">&apos;Hello World&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Example 2</span>
<span class="token comment">// express.json() is a middleware function which has req, res, next as parameters</span>
<span class="token comment">// it parses the request body and set the req.body when it meets json object</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></li>
<li><a href="https://medium.com/@jamischarles/what-is-middleware-a-simple-explanation-bb22d6b41d01">More Info About Middleware</a></li>
<li><a href="https://stackoverflow.com/questions/23259168/what-are-express-json-and-express-urlencoded/51844327#51844327">Some built-in middleware</a></li>
</ul>
<blockquote>
<p>Customized Middleware</p>
</blockquote>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token keyword keyword-const">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// `next` indicates next middleware</span>
<span class="token comment">// and pass control to the next middleware</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token keyword keyword-function">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;logging...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// If we don&apos;t have this line</span>
    <span class="token comment">// the middleware can&apos;t be passed to the next middleware</span>
    <span class="token comment">// since the req and res cycle isn&apos;t end, nothing can be displayed for the website</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// Use middleware function from other file</span>

<span class="token comment">// index.js: </span>
<span class="token keyword keyword-const">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> logger <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;./logger&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>logger<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// logger.js: </span>
<span class="token keyword keyword-function">function</span> <span class="token function">logger</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;logging...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> logger<span class="token punctuation">;</span>
</pre><blockquote>
<p>Environments</p>
</blockquote>
<ul>
<li>
<p>Two ways of getting environments</p>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript">process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token comment">// `undefined` by default</span>
</pre><pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token keyword keyword-const">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&apos;env&apos;</span><span class="token punctuation">)</span> <span class="token comment">// `development` by default</span>
</pre></li>
<li>
<p>Set environment variables</p>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// in terminal: </span>
<span class="token comment">// for example, set the NODE_ENV to development</span>
<span class="token keyword module keyword-export">export</span> <span class="token constant">NODE_ENV</span><span class="token operator">=</span>development
</pre></li>
<li>
<p>Use <code>config</code> package to set configuration</p>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// terminal: </span>
npm install config
</pre><ul>
<li>
<p>create a file named <code>config</code>.<br><br>
Inside the <code>config</code> file: create <code>development.json</code>, <code>production.json</code> (or maybe <code>staging.json</code>)<br><br>
The name before <code>.json</code> is the name in <code>process.env.NODE_ENV</code></p>
</li>
<li>
<p>Example 1 of using <code>config</code> package</p>
</li>
</ul>
<pre data-role="codeBlock" data-info="Json" class="language-json"><span class="token comment">// config/production.json:</span>
<span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;My Express App - Production&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;mail&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;host&quot;</span><span class="token operator">:</span> <span class="token string">&quot;prod-mail-server&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// config/development.json:</span>
<span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;My Express App - Development&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;mail&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;host&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dev-mail-server&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// terminal:</span>
export NODE_ENV=development
</pre><pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// index.js</span>
<span class="token keyword keyword-const">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;config&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">name: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>config<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&apos;name&apos;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// name: My Express App - Development</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">host: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>config<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&apos;mail.host&apos;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// host: dev-mail-server</span>
</pre><ul>
<li>Example 2 of using <code>config</code> package<br><br>
create <code>custom-environment-variables</code> file under <code>config</code></li>
</ul>
<pre data-role="codeBlock" data-info="JSON" class="language-json"><span class="token comment">// terminal: </span>
export app_password=<span class="token number">1234</span>

<span class="token comment">// config/custom-environment-variables</span>
<span class="token punctuation">{</span>
    <span class="token comment">// map mail.password with the environment variable `app_password`</span>
    <span class="token property">&quot;mail&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;password&quot;</span><span class="token operator">:</span> <span class="token string">&quot;app_password&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// index.js</span>
<span class="token keyword keyword-const">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;config&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">app_password: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>config<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&apos;mail.password&apos;</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1234</span>
</pre></li>
</ul>
<blockquote>
<p>Use <code>debug</code> package for debugging</p>
</blockquote>
<ul>
<li><code>npm install debug</code></li>
<li>Instead of writing <code>console.log(...)</code>, we can use the debug function from the <code>debug</code> package</li>
<li>Example:<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// terminal: </span>

<span class="token keyword module keyword-export">export</span> <span class="token constant">DEBUG</span><span class="token operator">=</span>app<span class="token operator">:</span>startUp <span class="token comment">// set the environment variable of `debug` package </span>
<span class="token keyword module keyword-export">export</span> <span class="token constant">DEBUG</span><span class="token operator">=</span>app<span class="token operator">:</span>startUp<span class="token punctuation">,</span>app<span class="token operator">:</span>db <span class="token comment">// show multiple debuggers&apos; results</span>
<span class="token keyword module keyword-export">export</span> <span class="token constant">NODE_ENV</span><span class="token operator">=</span>development


<span class="token comment">// index.js</span>
<span class="token keyword keyword-const">const</span> startUpDebugger <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;debug&apos;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&apos;app:startUp&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> dbDebugger <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;debug&apos;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&apos;app:db&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// we also can defile more deBugger function. By convention, one debugger for each file.</span>
<span class="token keyword keyword-const">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&apos;env&apos;</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&apos;development&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// If we set the DEBUG=app:startUp, the line below will be displayed. Otherwise, this line won&apos;t be displayed</span>
    <span class="token function">startUpDebugger</span><span class="token punctuation">(</span><span class="token string">&quot;It&apos;s development mode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre></li>
</ul>
<blockquote>
<p>Templating Engines <code>pug</code></p>
</blockquote>
<ul>
<li>Create the template for html</li>
<li><code>npm install pug</code></li>
</ul>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// index.js</span>
<span class="token keyword keyword-const">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;express&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">set</span><span class="token punctuation">(</span><span class="token string">&apos;view engine&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;pug&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// we can use express to set and we don&apos;t have to require</span>
app<span class="token punctuation">.</span><span class="token method function property-access">set</span><span class="token punctuation">(</span><span class="token string">&apos;views&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;./views&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// all the view engines&apos; files inside the `views` folder</span>

app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// instead of using `res.send`, use `res.render` to use `pug` template</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token string">&apos;index&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>title<span class="token operator">:</span> <span class="token string">&apos;My Express App&apos;</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">&apos;Hello&apos;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Listening on port 3000...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// views/index.js (where we define the view engine, can be other than index.js)</span>
html
    head
        <span class="token comment">// the first `title` represents html&apos;s title tag</span>
        <span class="token comment">// the second `title` represents the variable named `title` to be passed in</span>
        title<span class="token operator">=</span> title
    body
        h1<span class="token operator">=</span> message
</pre><pre data-role="codeBlock" data-info="html" class="language-html"><span class="token comment">&lt;!-- When the above example printed on website, we get the source code as below --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>My Express App<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</pre><blockquote>
<p>Structure the NodeJS App</p>
</blockquote>
<ul>
<li><a href="https://github.com/DylanLin29/Notes/tree/master/Web%20Development/NodeJS/structure_express_app">separating different routes into different files</a></li>
</ul>
<br>
<h3 class="mume-header" id="2-difference-between-synchronous-code-and-asynchronous-code">2. Difference between <code>Synchronous Code</code> and <code>Asynchronous Code</code></h3>

<hr>
<p><code>Synchronous Code:</code></p>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// Only after the first line is executed, </span>
<span class="token comment">// the second line can be executed</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Before&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;After&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// Console:</span>
<span class="token maybe-class-name">Before</span>
<span class="token maybe-class-name">After</span>
</pre><hr>
<p><code>Asynchronous Code:</code></p>
<ul>
<li>not multi threads or concurrently</li>
<li>single thread</li>
</ul>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// setTimeout is an asynchronous function</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Before&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Reading a user from a database&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;After&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><blockquote>
<p>After the first line is executed, go to the second line.<br>
While waiting for 2 seconds, go to the third line. After the third line is executed, execute the second line once 2 seconds have passed.</p>
</blockquote>
<pre data-role="codeBlock" data-info="C++" class="language-cpp"><span class="token comment">// Console:</span>
Before
After
Reading a user from a database
</pre><h3 class="mume-header" id="3-dealing-with-asynchronous-code">3. Dealing with <code>Asynchronous Code</code>:</h3>

<hr>
<ol>
<li><code>Callbacks</code></li>
<li><code>Promises</code></li>
<li><code>Async/await</code></li>
</ol>
<p>Example.</p>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Before&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> user <span class="token operator">=</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;After&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-function">function</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Reading a user from a database...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow keyword-return">return</span> <span class="token punctuation">{</span>id<span class="token operator">:</span> id<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><blockquote>
<ol>
<li>Execute the first line (<code>Before</code>)</li>
<li>Excute the function (return value is not available by the time of calling the function, so it&apos;s undefined)</li>
<li>Execute the forth line (<code>After</code>)</li>
<li>After the 2-second countdown (<code>Reading a user from a database...</code>)</li>
</ol>
</blockquote>
<pre data-role="codeBlock" data-info="C++" class="language-cpp"><span class="token comment">// console</span>
Before
undefined
After
Reading a user from a database<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</pre><hr>
<ol>
<li><code>Callbacks</code><br>
Solve example above</li>
</ol>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Before&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">getUser</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;User&apos;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;After&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-function">function</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Reading a user from a database...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> id<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// console:</span>
<span class="token maybe-class-name">Before</span>
<span class="token maybe-class-name">After</span>
<span class="token maybe-class-name">Reading</span> a user <span class="token keyword module keyword-from">from</span> a database
<span class="token maybe-class-name">User</span> <span class="token punctuation">{</span>id<span class="token operator">:</span> id<span class="token punctuation">}</span>
</pre><p>2nd Example (double callback)</p>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Before&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">getUser</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">getRepos</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token property-access">githubId</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">repos</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>repos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;After&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-function">function</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Reading a user from a database...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> id<span class="token punctuation">,</span> githubId<span class="token operator">:</span> <span class="token string">&apos;Dylan&apos;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-function">function</span> <span class="token function">getRepos</span><span class="token punctuation">(</span><span class="token parameter">username<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Calling Github API...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&apos;repo1&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;repo2&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><pre data-role="codeBlock" data-info="C++" class="language-cpp"><span class="token comment">// Console</span>
Before
After
Reading a user from a database<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> githubId<span class="token operator">:</span> <span class="token string">&apos;Dylan&apos;</span> <span class="token punctuation">}</span>
Calling Github API<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span> <span class="token string">&apos;repo1&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;repo2&apos;</span> <span class="token punctuation">]</span>
</pre><p><code>Named function</code> to solve <code>nested callback</code>:</p>
<ul>
<li>in order to make nested callbacks look better</li>
</ul>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Before&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">getUser</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> getReposAndUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;After&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-function">function</span> <span class="token function">getReposAndUser</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">getRepos</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token property-access">githubId</span><span class="token punctuation">,</span> displayRepos<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-function">function</span> <span class="token function">displayRepos</span><span class="token punctuation">(</span><span class="token parameter">repos</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>repos<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-function">function</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Reading a user from a database...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> id<span class="token punctuation">,</span> githubId<span class="token operator">:</span> <span class="token string">&apos;Dylan&apos;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-function">function</span> <span class="token function">getRepos</span><span class="token punctuation">(</span><span class="token parameter">username<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Calling Github API...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&apos;repo1&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;repo2&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><hr>
<ol start="2">
<li><code>Promises</code></li>
</ol>
<ul>
<li>Promises holds the eventual result of an asynchronous operation</li>
<li>Promises initial with pending state, then go to the result state or reject state.</li>
</ul>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token keyword keyword-const">const</span> p <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// async work</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// resolve(1);</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&apos;something went wrong...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

p
    <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Result:&apos;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// get the result</span>
    <span class="token punctuation">.</span><span class="token keyword control-flow keyword-catch">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Error:&apos;</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// catch the error</span>
</pre><pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// Console:</span>
<span class="token known-class-name class-name">Error</span><span class="token operator">:</span> something went wrong
</pre><pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token keyword keyword-const">const</span> p <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// async work</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// reject(new Error(&apos;something went wrong...&apos;));</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

p
    <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Result:&apos;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// get the result</span>
    <span class="token punctuation">.</span><span class="token keyword control-flow keyword-catch">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Error:&apos;</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// catch the error</span>
</pre><pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// Console:</span>
<span class="token maybe-class-name">Result</span><span class="token operator">:</span> <span class="token number">1</span>
</pre><ul>
<li>Convert from <code>callback</code> to <code>promises</code></li>
</ul>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// Callback</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Before&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">getUser</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> getReposAndUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;After&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-function">function</span> <span class="token function">getReposAndUser</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">getRepos</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token property-access">githubId</span><span class="token punctuation">,</span> displayRepos<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-function">function</span> <span class="token function">displayRepos</span><span class="token punctuation">(</span><span class="token parameter">repos</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>repos<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-function">function</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Reading a user from a database...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> id<span class="token punctuation">,</span> githubId<span class="token operator">:</span> <span class="token string">&apos;Dylan&apos;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-function">function</span> <span class="token function">getRepos</span><span class="token punctuation">(</span><span class="token parameter">username<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Calling Github API...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&apos;repo1&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;repo2&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// Promises</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Before&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">getUser</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">user</span> <span class="token arrow operator">=&gt;</span> <span class="token function">getRepos</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token property-access">githubId</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;After&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-function">function</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Reading a user from a database...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> id<span class="token punctuation">,</span> githubId<span class="token operator">:</span> <span class="token string">&apos;Dylan&apos;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-function">function</span> <span class="token function">getRepos</span><span class="token punctuation">(</span><span class="token parameter">username</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Calling Github API...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&apos;repo1&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;repo2&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><ul>
<li>Parallel Promises:</li>
<li>(Not concurrent nor multiple threads)</li>
</ul>
<blockquote>
<p>Promise.all</p>
</blockquote>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// Promise.all example 1</span>
<span class="token keyword keyword-const">const</span> p1 <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Async operation 1...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> p2 <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Async operation 2...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// Pramise.all example 1 result</span>
<span class="token comment">// The following lines almost appear at the same time</span>
<span class="token maybe-class-name">Async</span> operation <span class="token number">1.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token property-access"><span class="token maybe-class-name">Async</span></span> operation <span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token punctuation">]</span>
</pre><pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// Promise.all example 2</span>
<span class="token keyword keyword-const">const</span> p1 <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Async operation 1...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> p2 <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Async operation 2...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// Promise.all example 2 result</span>
<span class="token comment">// The first line appears after 1 second and the second line appears after another second</span>
<span class="token maybe-class-name">Async</span> operation <span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token property-access"><span class="token maybe-class-name">Async</span></span> operation <span class="token number">1.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token punctuation">]</span>
</pre><pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// Promise.all example 3</span>
<span class="token keyword keyword-const">const</span> p1 <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Async operation 1...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&apos;Something went wrong&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> p2 <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Async operation 2...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token keyword control-flow keyword-catch">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// Promise.all example 3 result</span>
<span class="token comment">// As long as one async operation is rejected, only get the error message since all the async operations are binded together</span>
<span class="token maybe-class-name">Async</span> operation <span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token property-access"><span class="token maybe-class-name">Async</span></span> operation <span class="token number">1.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token property-access"><span class="token maybe-class-name">Something</span></span> went wrong
</pre><blockquote>
<p>Promise.race</p>
</blockquote>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// Promise.race example 1</span>
<span class="token keyword keyword-const">const</span> p1 <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Async operation 1...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> p2 <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Async operation 2...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// Promise.race example 2 result</span>
<span class="token comment">// Only get the first fulfilled Async function (either reject or resolve)</span>
<span class="token maybe-class-name">Async</span> operation <span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">2</span>
<span class="token maybe-class-name">Async</span> operation <span class="token number">1.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</pre><hr>
<ol start="3">
<li><code>Async and Await</code></li>
</ol>
<ul>
<li>In order to use the <code>async and await</code> method, we need to convert the <code>callback</code> function to <code>Promise</code> first</li>
<li>Convert the <code>Promise</code> approach to <code>Async and Await</code> method</li>
</ul>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// Promise method</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Before&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">getUser</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">user</span> <span class="token arrow operator">=&gt;</span> <span class="token function">getRepos</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token property-access">githubId</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;After&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-function">function</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Reading a user from a database...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> id<span class="token punctuation">,</span> githubId<span class="token operator">:</span> <span class="token string">&apos;Dylan&apos;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-function">function</span> <span class="token function">getRepos</span><span class="token punctuation">(</span><span class="token parameter">username</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Calling Github API...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&apos;repo1&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;repo2&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// Async and await method</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Before&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// The await function only works in an async function</span>
<span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">displayRepos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// we have to use the try catch block to catch the errors</span>
    <span class="token keyword control-flow keyword-try">try</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> user <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> repos <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token function">getRepos</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token property-access">githubId</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>repos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-catch">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Error&apos;</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">displayRepos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;After&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword keyword-function">function</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Reading a user from a database...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> id<span class="token punctuation">,</span> githubId<span class="token operator">:</span> <span class="token string">&apos;Dylan&apos;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-function">function</span> <span class="token function">getRepos</span><span class="token punctuation">(</span><span class="token parameter">username</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Calling Github API...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&apos;repo1&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;repo2&apos;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><h3 class="mume-header" id="3-database-mongodb">3. Database <code>MongoDB</code>:</h3>

<hr>
<p>3.1 <code>Mongoose</code>:</p>
<ul>
<li>Connect <code>mongoose</code> to <code>mongodb</code>:</li>
</ul>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token keyword keyword-const">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;mongoose&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

mongoose<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token string">&apos;mongodb://localhost/playground&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    useUnifiedTopology<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// since mongoose.connect returns a promise, we can use then and catch</span>
    <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Connected to MongoDB...&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token keyword control-flow keyword-catch">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&apos;Could not connect to MongoDB...&apos;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><blockquote>
<p>In order to successfully connect with local MongoDB, we need to start the MongoDB server before running the code above<br><br>
(current user is <code>dylan</code>)<br><br>
<code>mkdir -p /Users/dylan/data/db</code>(only the first time)<br><br>
<code>mongod --dbpath=/Users/dylan/data/db</code></p>
</blockquote>
<ul>
<li>Schema: <br><br>
type: <code>String</code>, <code>Number</code>, <code>Date</code>, <code>Buffer</code>(use to store binary data), <code>Boolean</code>, <code>ObjectID</code>(unique identifier), <code>Array</code></li>
</ul>
<br>
<b>create a CourseSchema and save the data</b>
<br>
Example: 
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token keyword keyword-const">const</span> courseSchema <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span>
    author<span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span>
    tags<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token known-class-name class-name">String</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    date<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token known-class-name class-name">Date</span><span class="token punctuation">,</span> <span class="token keyword module keyword-default">default</span><span class="token operator">:</span> <span class="token known-class-name class-name">Date</span><span class="token punctuation">.</span><span class="token property-access">now</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    isPublished<span class="token operator">:</span> <span class="token known-class-name class-name">Boolean</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// create the model class of the schema</span>
<span class="token keyword keyword-const">const</span> <span class="token maybe-class-name">Course</span> <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token method function property-access">model</span><span class="token punctuation">(</span><span class="token string">&apos;Course&apos;</span><span class="token punctuation">,</span> courseSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// the await method has to be wrapped inside the async function</span>
<span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">createCourse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// create an instance of the class above</span>
    <span class="token keyword keyword-const">const</span> course <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Course</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">&apos;Angular&apos;</span><span class="token punctuation">,</span>
        author<span class="token operator">:</span> <span class="token string">&apos;Dylan&apos;</span><span class="token punctuation">,</span>
        tags<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&apos;angular&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;frontend&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        isPublished<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// async operation (return a promise)</span>
    <span class="token comment">// save the info in the mongodb database using the save method</span>
    <span class="token keyword keyword-const">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> course<span class="token punctuation">.</span><span class="token method function property-access">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">createCourse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><br>
<p><b>query data</b><br></p>
<p>Example:</p>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// Course is the created mongoose model above</span>
<span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">getCourse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> courses <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token maybe-class-name">Course</span>
        <span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> author<span class="token operator">:</span> <span class="token string">&apos;Dylan&apos;</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">&apos;Node.js&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// nothing is specified, get everything from Course</span>
        <span class="token comment">// below are optional</span>
        <span class="token punctuation">.</span><span class="token method function property-access">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// sort by name, 1 indicates ascending order (a-z), -1 indicates decending order</span>
        <span class="token punctuation">.</span><span class="token method function property-access">select</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> tags<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// indicate that we only want to get the name and tags properties</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>courses<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><blockquote>
<p>Some query operators</p>
</blockquote>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// eq (equal)</span>
<span class="token comment">// ne (not equal)</span>
<span class="token comment">// gt (greater than)</span>
<span class="token comment">// gte (greater than or equal to)</span>
<span class="token comment">// lt (less than)</span>
<span class="token comment">// lte (less than or equal to)</span>
<span class="token comment">// in</span>
<span class="token comment">// nin (not in)</span>
<span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">getCourses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> courses <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token maybe-class-name">Course</span>
        <span class="token comment">// .find({ price: {$in [10, 15, 20]}})</span>
        <span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> price<span class="token operator">:</span> <span class="token punctuation">{</span>$gte<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> $lte<span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// courses less than or equal to 20 and greater than 10</span>
<span class="token punctuation">}</span>
</pre><blockquote>
<p>count: return the number of documents that satisfy the query</p>
</blockquote>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">getCourses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> courses <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token maybe-class-name">Course</span>
        <span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</pre><pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// Console</span>
<span class="token maybe-class-name">Connected</span> to <span class="token maybe-class-name">MongoDB</span><span class="token spread operator">...</span>
<span class="token number">2</span> <span class="token comment">// 2 of the documents satisfy the query</span>
</pre><blockquote>
<p>Pagination: get all the documents of a page</p>
</blockquote>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">getCourses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// assume we want the document at page 2</span>
    <span class="token keyword keyword-const">const</span> pageNumber <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> pageSize <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-const">const</span> courses <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token maybe-class-name">Course</span>
        <span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// Use the code below to get the courses at the desired page</span>
        <span class="token punctuation">.</span><span class="token method function property-access">skip</span><span class="token punctuation">(</span><span class="token punctuation">(</span>pageNumber <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> pageSize<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token method function property-access">limit</span><span class="token punctuation">(</span>pageSize<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</pre><blockquote>
<p>Some logical query operators</p>
</blockquote>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// or</span>
<span class="token comment">// and</span>
<span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">getCourses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> courses <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token maybe-class-name">Course</span>
        <span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token method function property-access">or</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span>author<span class="token operator">:</span> <span class="token string">&apos;Dylan&apos;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>isPublished<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// return all the courses that either author is &apos;Dylan&apos; or isPublished</span>
<span class="token punctuation">}</span>
</pre><blockquote>
<p>Some query operators with regular expression</p>
</blockquote>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">getCourses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> courses <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token maybe-class-name">Course</span>
        <span class="token comment">// /.../ indicates regular expression</span>
        <span class="token comment">// /^.../ indicates all the string starts with ...</span>
        <span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> author<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^Dylan</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token comment">// /...$/ indicates all the string ends with ...</span>
        <span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> author<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Dylan$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token comment">// i indicates case insensitive</span>
        <span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> author<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Dylan$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token comment">// /.*Dylan.*/ means contains Dylan</span>
        <span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> author<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.*Dylan.*</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">getCourses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> courses <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token maybe-class-name">Course</span>

<span class="token punctuation">}</span>
</pre><p>(Check the tutorials of regular expressions to get more information)</p>
<br>
<b>Update data</b>
<br>
<ul>
<li>Method 1: query first, findById(), Modify its properties, and then save()</li>
</ul>
<p>Example:</p>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">updateCourse</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Course.findById returns a promise</span>
    <span class="token keyword keyword-const">const</span> course <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token maybe-class-name">Course</span><span class="token punctuation">.</span><span class="token method function property-access">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// When the course is not found in the database, return</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>course<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow keyword-return">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Example updates: </span>
    course<span class="token punctuation">.</span><span class="token property-access">author</span> <span class="token operator">=</span> <span class="token string">&apos;Another author&apos;</span><span class="token punctuation">;</span>
    <span class="token comment">// Another way of updating the data:</span>
    course<span class="token punctuation">.</span><span class="token method function property-access">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        isPublished<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        author<span class="token operator">:</span> <span class="token string">&apos;Another Author&apos;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// result is the updated version of the course</span>
    <span class="token keyword keyword-const">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> course<span class="token punctuation">.</span><span class="token method function property-access">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">updateCourse</span><span class="token punctuation">(</span>someID<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><ul>
<li>Method 2: update the data directly</li>
</ul>
<p>Example:</p>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">updateCourse</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// retrieve every course from the database whose `isPublished` field is `false`</span>
    <span class="token comment">// use mongodb update operator `$set`</span>
    <span class="token keyword keyword-const">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token maybe-class-name">Course</span><span class="token punctuation">.</span><span class="token method function property-access">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>isPublished<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token comment">// there are more mongodb operators on `https://docs.mongodb.com/manual/reference/operator/update/`</span>
        <span class="token comment">// here is an example of using $set as the operator</span>
        $set<span class="token operator">:</span> <span class="token punctuation">{</span>
            author<span class="token operator">:</span> <span class="token string">&apos;Dylan&apos;</span><span class="token punctuation">,</span>
            isPublished<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// another way of updating the course by id</span>
    <span class="token keyword control-flow keyword-await">await</span> <span class="token maybe-class-name">Course</span><span class="token punctuation">.</span><span class="token method function property-access">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>_id<span class="token operator">:</span> id<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        $set<span class="token operator">:</span> <span class="token punctuation">{</span>
            author<span class="token operator">:</span> <span class="token string">&apos;Dylan&apos;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token comment">// {n: 1, nModified: 1, ok: 1} indicates how many datas are modified</span>


    <span class="token comment">// if we don&apos;t want to retrieve the results as above</span>
    <span class="token comment">// instead, we want to retrieve the courses</span>
    <span class="token keyword keyword-const">const</span> course <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token maybe-class-name">Course</span><span class="token punctuation">.</span><span class="token method function property-access">findByIdAndUpdate</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        $set<span class="token operator">:</span> <span class="token punctuation">{</span>
            author<span class="token operator">:</span> <span class="token string">&apos;Dylan&apos;</span>
        <span class="token punctuation">}</span>
    <span class="token comment">// to get the updated data, include {new: true}</span>
    <span class="token comment">// if not, the return course is the previous versions</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token keyword keyword-new">new</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</pre><br>
<b>Remove data</b>
<br>
<pre data-role="codeBlock" data-info="Javascript" class="language-javascript"><span class="token comment">// Remove data example</span>
<span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span> <span class="token function">removeCourse</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token maybe-class-name">Course</span><span class="token punctuation">.</span><span class="token method function property-access">deleteOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token operator">:</span> id <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// shows number of documents is deleted</span>

    <span class="token comment">// delete the first one that satisfy the requirements</span>
    <span class="token keyword control-flow keyword-await">await</span> <span class="token maybe-class-name">Course</span><span class="token punctuation">.</span><span class="token method function property-access">deleteOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> isPublished<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// delete every document that satisfy the requirements</span>
    <span class="token keyword keyword-const">const</span> resultMany <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token maybe-class-name">Course</span><span class="token punctuation">.</span><span class="token method function property-access">deleteMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span> isPublished<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>resultMany<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// shows number of documents is deleted</span>

    <span class="token keyword keyword-const">const</span> course <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token maybe-class-name">Course</span><span class="token punctuation">.</span><span class="token method function property-access">findByIdAndDelete</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>course<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// get the deleted course document</span>
<span class="token punctuation">}</span>
</pre><h3 class="mume-header" id="4-authentication-and-autherization">4. Authentication and Autherization:</h3>

<hr>
<blockquote>
<p>Store password</p>
</blockquote>
<ul>
<li>Hashing library: <code>npm install bcrypt</code><pre data-role="codeBlock" data-info="Javascript" class="language-javascript">    <span class="token comment">// Example of hashing the password</span>

    <span class="token keyword keyword-const">const</span> bcrypt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;bcrypt&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// we need to generate the salt before hashing</span>
    <span class="token comment">// create the salt for 10 rounds this time</span>
    <span class="token keyword keyword-const">const</span> salt <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> bcrypt<span class="token punctuation">.</span><span class="token method function property-access">genSalt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cosnt newPassword <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> bcrypt<span class="token punctuation">.</span><span class="token method function property-access">hash</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> salt<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><pre data-role="codeBlock" data-info="Javascript" class="language-javascript">    <span class="token comment">// Example of comparing the hashed password with the entered password</span>
    <span class="token keyword keyword-const">const</span> bcrypt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;bcrypt&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// validatePassword is either true or false</span>
    <span class="token comment">// hashed_password is usually from the database</span>
    <span class="token keyword keyword-const">const</span> validPassword <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> bcrypt<span class="token punctuation">.</span><span class="token method function property-access">compare</span><span class="token punctuation">(</span>entered_password<span class="token punctuation">,</span> hashded_password<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></li>
<li>Json Web Token</li>
</ul>

      </div>
      
      
    
    
    
    
    
    
    
    
  
    </body></html>